---
description: API integration patterns and HTTP client configuration
globs: ["**/*.js", "**/*.jsx", "**/*.ts", "**/*.tsx"]
alwaysApply: false
priority: 4
---

# API Architecture Rules

## Current Status

⚠️ **IMPORTANT**: The project is currently in **demo mode** using localStorage for data persistence. All API-related code should be prepared for future backend integration.

## Future API Integration Patterns

When backend API is ready, follow these patterns:

### API Service Structure

```javascript
// ✅ CORRECT: Create API service files
// src/services/api.js or src/api/apiClient.js

import axios from 'axios'; // Or use fetch

const API_BASE_URL = process.env.REACT_APP_API_BASE_URL || 'http://localhost:3001/api';

const apiClient = axios.create({
  baseURL: API_BASE_URL,
  timeout: 10000,
  headers: {
    'Content-Type': 'application/json',
  },
});

// Request interceptor for auth tokens
apiClient.interceptors.request.use(
  (config) => {
    const token = localStorage.getItem('authToken');
    if (token) {
      config.headers.Authorization = `Bearer ${token}`;
    }
    return config;
  },
  (error) => Promise.reject(error)
);

// Response interceptor for error handling
apiClient.interceptors.response.use(
  (response) => response.data,
  (error) => {
    if (error.response?.status === 401) {
      // Handle unauthorized
      localStorage.removeItem('authToken');
      window.location.href = '/signin';
    }
    return Promise.reject(error);
  }
);

export default apiClient;
```

### API Service Functions

```javascript
// ✅ CORRECT: Create service functions for API calls
// src/services/jobService.js

import apiClient from './api';

export const jobService = {
  // Get all jobs
  getJobs: async (filters = {}) => {
    try {
      const response = await apiClient.get('/jobs', { params: filters });
      return response;
    } catch (error) {
      console.error('Error fetching jobs:', error);
      throw error;
    }
  },

  // Get job by ID
  getJobById: async (id) => {
    try {
      const response = await apiClient.get(`/jobs/${id}`);
      return response;
    } catch (error) {
      console.error('Error fetching job:', error);
      throw error;
    }
  },

  // Create job
  createJob: async (jobData) => {
    try {
      const response = await apiClient.post('/jobs', jobData);
      return response;
    } catch (error) {
      console.error('Error creating job:', error);
      throw error;
    }
  },

  // Update job
  updateJob: async (id, jobData) => {
    try {
      const response = await apiClient.put(`/jobs/${id}`, jobData);
      return response;
    } catch (error) {
      console.error('Error updating job:', error);
      throw error;
    }
  },

  // Delete job
  deleteJob: async (id) => {
    try {
      const response = await apiClient.delete(`/jobs/${id}`);
      return response;
    } catch (error) {
      console.error('Error deleting job:', error);
      throw error;
    }
  },
};
```

## Component Integration Pattern

### ✅ CORRECT: Using API in Components

```javascript
import React, { useState, useEffect } from 'react';
import { jobService } from '../services/jobService';

function Jobs() {
  const [jobs, setJobs] = useState([]);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState(null);

  useEffect(() => {
    const fetchJobs = async () => {
      setLoading(true);
      setError(null);
      
      try {
        const data = await jobService.getJobs();
        setJobs(data);
      } catch (err) {
        setError(err.message || 'Failed to fetch jobs');
      } finally {
        setLoading(false);
      }
    };

    fetchJobs();
  }, []);

  if (loading) return <div>Loading...</div>;
  if (error) return <div>Error: {error}</div>;

  return (
    <div>
      {jobs.map(job => (
        <div key={job.id}>{job.title}</div>
      ))}
    </div>
  );
}
```

### ✅ CORRECT: Error Handling Pattern

```javascript
const handleSubmit = async (formData) => {
  setLoading(true);
  setError(null);

  try {
    const response = await jobService.createJob(formData);
    // Success handling
    navigate('/jobs');
  } catch (err) {
    // Error handling
    if (err.response?.status === 400) {
      setError('Invalid data. Please check your input.');
    } else if (err.response?.status === 401) {
      setError('You must be logged in to post a job.');
      navigate('/signin');
    } else {
      setError('An error occurred. Please try again.');
    }
  } finally {
    setLoading(false);
  }
};
```

## Current Demo Mode Pattern

### ✅ CORRECT: localStorage Pattern (Current Implementation)

```javascript
// Currently using localStorage for demo
useEffect(() => {
  const signedIn = localStorage.getItem('isSignedIn') === 'true';
  const userData = JSON.parse(localStorage.getItem('userData') || 'null');
  
  setIsSignedIn(signedIn);
  setUserData(userData);
}, []);

// TODO: Replace with API call when backend is ready
// const response = await authService.getCurrentUser();
```

### Preparation for API Migration

```javascript
// ✅ CORRECT: Structure code to easily migrate to API
function UserDashboard() {
  const [user, setUser] = useState(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const fetchUserData = async () => {
      // Currently using localStorage
      const storedData = localStorage.getItem('userData');
      if (storedData) {
        setUser(JSON.parse(storedData));
      }
      
      // TODO: Replace with API call
      // try {
      //   const userData = await userService.getCurrentUser();
      //   setUser(userData);
      // } catch (error) {
      //   console.error('Error fetching user:', error);
      // }
      
      setLoading(false);
    };

    fetchUserData();
  }, []);

  if (loading) return <div>Loading...</div>;
  if (!user) return <div>No user data</div>;

  return <div>{/* User dashboard */}</div>;
}
```

## Environment Variables

```javascript
// ✅ CORRECT: Use environment variables for API configuration
// .env.development
REACT_APP_API_BASE_URL=http://localhost:3001/api

// .env.production
REACT_APP_API_BASE_URL=https://api.cheffinder.com/api

// In code
const API_URL = process.env.REACT_APP_API_BASE_URL;
```

## API Route Constants

```javascript
// ✅ CORRECT: Centralize API routes
// src/constants/apiRoutes.js

export const API_ROUTES = {
  // Auth
  AUTH: {
    LOGIN: '/auth/login',
    REGISTER: '/auth/register',
    LOGOUT: '/auth/logout',
    REFRESH: '/auth/refresh',
  },
  
  // Jobs
  JOBS: {
    BASE: '/jobs',
    BY_ID: (id) => `/jobs/${id}`,
    APPLY: (id) => `/jobs/${id}/apply`,
    SAVE: (id) => `/jobs/${id}/save`,
  },
  
  // Users
  USERS: {
    BASE: '/users',
    PROFILE: '/users/profile',
    RESUME: '/users/resume',
  },
  
  // Employers
  EMPLOYERS: {
    BASE: '/employers',
    JOBS: '/employers/jobs',
    APPLICANTS: '/employers/applicants',
  },
};

// Usage
import { API_ROUTES } from '../constants/apiRoutes';
const response = await apiClient.get(API_ROUTES.JOBS.BASE);
```

## Prohibited Patterns

### ❌ WRONG: Direct fetch calls in components

```javascript
// Don't scatter API calls throughout components
function Jobs() {
  useEffect(() => {
    fetch('http://localhost:3001/api/jobs') // Wrong
      .then(res => res.json())
      .then(data => setJobs(data));
  }, []);
}
```

### ❌ WRONG: Hardcoded API URLs

```javascript
// Don't hardcode API URLs
const response = await fetch('http://localhost:3001/api/jobs'); // Wrong
// Use environment variables
```

### ❌ WRONG: No error handling

```javascript
// Always handle errors
const data = await apiClient.get('/jobs'); // Missing error handling
setJobs(data);
```

## Remember

- **Currently** using localStorage for demo purposes
- **Prepare** all code for easy migration to API
- **Always** use service layer for API calls (don't call API directly in components)
- **Always** handle errors appropriately
- **Always** use environment variables for API URLs
- **Always** centralize API routes in constants file
- **Always** include loading and error states in components
- **Never** hardcode API URLs or credentials
